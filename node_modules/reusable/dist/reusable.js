var t,e=require("react"),r=(t=e)&&"object"==typeof t&&"default"in t?t.default:t,n=function(t){this.subscribers=[],this.cachedValue=null,this.fn=t};n.prototype.getValue=function(){return this.cachedValue},n.prototype.run=function(){return this.cachedValue=this.fn(),this.cachedValue},n.prototype.subscribe=function(t){var e=this;return this.subscribers=this.subscribers.concat([t]),function(){e.subscribers=e.subscribers.filter(function(e){return e!==t})}},n.prototype.notify=function(){var t=this;this.subscribers.forEach(function(e){return e(t.cachedValue)})};var u=function(){this.units=new Map,this.subscribers=[]};u.prototype.onUnitsChanged=function(t){var e=this;return this.subscribers=this.subscribers.concat([t]),function(){return e.subscribers=e.subscribers.filter(function(e){return e!==t})}},u.prototype.createUnit=function(t){if(this.units.has(t))throw new Error("Unit already exist",t);var e=new n(t);this.units.set(t,e),this.notifyUnitsChanged()},u.prototype.getUnit=function(t){if(!this.units.has(t))throw new Error("Unit doesn't exist",t);return this.units.get(t)},u.prototype.notifyUnitsChanged=function(){this.subscribers.forEach(function(t){return t()})},u.prototype.getUnitsArray=function(){var t=[];return this.units.forEach(function(e){t.push(e)}),t};var i=new u,o=function(){return i},s=Object.prototype.hasOwnProperty;function c(t,e){return t===e?0!==t||0!==e||1/t==1/e:t!=t&&e!=e}function a(t,e){if(c(t,e))return!0;if("object"!=typeof t||null===t||"object"!=typeof e||null===e)return!1;var r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(var u=0;u<r.length;u++)if(!s.call(e,r[u])||!c(t[r[u]],e[r[u]]))return!1;return!0}var f=r.createContext(),h=function(t){var r=t.unit;return r.run(),e.useEffect(function(){return r.notify()},[r.cachedValue]),null},l=function(){var t=e.useContext(f);if(void 0===t)throw new Error("Are you trying to use Reusable without a ReusableProvider?");return t},b=function(){var t=l(),n=e.useState(function(){return t.getUnitsArray()}),u=n[0],i=n[1];return e.useEffect(function(){return t.onUnitsChanged(function(){i(t.getUnitsArray())})},[]),r.createElement(r.Fragment,null,u.map(function(t,e){return r.createElement(h,{key:e,unit:t})}))},p=function(t){return t};exports.createStore=function(){return new u},exports.getStore=o,exports.replaceStore=function(t){return i=t},exports.ReusableProvider=function(t){var e=t.children;return r.createElement(f.Provider,{value:o()},r.createElement(r.Fragment,null,r.createElement(b,null),e))},exports.reusable=function(t){return o().createUnit(t),function(r,n){return function(t,r,n){void 0===r&&(r=p),void 0===n&&(n=a);var u=l().getUnit(t),i=e.useState(function(){return r(u.getValue())}),o=i[0],s=i[1];return e.useEffect(function(){return u.subscribe(function(t){var e=r(t);n(e,o)||s(function(){return e})})},[u,o,r,n]),o}(t,r,n)}};
//# sourceMappingURL=reusable.js.map
