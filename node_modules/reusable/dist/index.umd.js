!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t(e.reusable={},e.react)}(this,function(e,t){var r=function(e){this.fn=e,this.subscribers=[],this.cachedValue=null,this.name=e.name||"Store"};r.prototype.getCachedValue=function(){return this.cachedValue},r.prototype.useValue=function(){return this.cachedValue=this.fn(),this.cachedValue},r.prototype.subscribe=function(e){var t=this;return this.subscribers=this.subscribers.concat([e]),function(){t.subscribers=t.subscribers.filter(function(t){return t!==e})}},r.prototype.notify=function(){var e=this;this.subscribers.forEach(function(t){return t(e.cachedValue)})};var n=function(){this.stores=new Map,this.subscribers=[]};n.prototype.onStoresChanged=function(e){var t=this;return this.subscribers=this.subscribers.concat([e]),function(){t.subscribers=t.subscribers.filter(function(t){return t!==e})}},n.prototype.createStore=function(e){if(this.stores.has(e))throw new Error("Store already exist");var t=new r(e);return this.stores.set(e,t),this.notifyStoresChanged(),t},n.prototype.getStore=function(e){if(!this.stores.has(e))throw new Error("Store doesn't exist");return this.stores.get(e)},n.prototype.notifyStoresChanged=function(){this.subscribers.forEach(function(e){return e()})},n.prototype.getStoresArray=function(){var e=[];return this.stores.forEach(function(t){e.push(t)}),e};var u=new n,o=function(){return u},i=Object.prototype.hasOwnProperty;function s(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}function a(e,t){if(s(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var u=0;u<r.length;u++)if(!i.call(t,r[u])||!s(e[r[u]],t[r[u]]))return!1;return!0}var c=t.createContext(null),f=function(e){var r=e.children;return t.createElement(c.Provider,{value:o()},t.createElement(t.Fragment,null,t.createElement(b,null),r))};Object.defineProperty(f,"displayName",{value:"ReusableProvider"});var l=new Map,h=function(){var e=t.useContext(c);if(null===e)throw new Error("Are you trying to use Reusable without a ReusableProvider?");return e},b=function(){var e=h(),r=t.useState(function(){return e.getStoresArray()}),n=r[0],u=r[1];return t.useEffect(function(){return e.onStoresChanged(function(){u(e.getStoresArray())})},[]),t.createElement(t.Fragment,null,n.map(function(e,r){var n=function(e){if(!l.has(e)){var r=t.memo(function(){return e.useValue(),t.useEffect(function(){return e.notify()},[e.cachedValue]),null});Object.defineProperty(r,"name",{value:e.name}),l.set(e,r)}return l.get(e)}(e);return t.createElement(n,{key:r,store:e})}))};Object.defineProperty(b,"displayName",{value:"Stores"});var p=function(e){return e};e.Store=r,e.Container=n,e.createContainer=function(){return new n},e.getContainer=o,e.replaceContainer=function(e){return u=e},e.ReusableProvider=f,e.createStore=function(e){var r=o().createStore(e);return function(n,u){return t.useDebugValue(r.name),function(e,r,n){var u=h().getStore(e);t.useDebugValue("reusable");var o=t.useState(function(){return r(u.getCachedValue())}),i=o[0],s=o[1];return t.useEffect(function(){return u.subscribe(function(e){var t=r(e);n(t,i)||s(function(){return t})})},[u,i,r,n]),i}(e,n||p,u||a)}}});
//# sourceMappingURL=index.umd.js.map
