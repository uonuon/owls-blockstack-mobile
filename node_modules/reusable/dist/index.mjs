import{useState as r,useContext as t,useEffect as e,createContext as n,createElement as u,Fragment as o,memo as i,useDebugValue as s}from"react";var c=function(r){this.fn=r,this.subscribers=[],this.cachedValue=null,this.name=r.name||"Store"};c.prototype.getCachedValue=function(){return this.cachedValue},c.prototype.useValue=function(){return this.cachedValue=this.fn(),this.cachedValue},c.prototype.subscribe=function(r){var t=this;return this.subscribers=this.subscribers.concat([r]),function(){t.subscribers=t.subscribers.filter(function(t){return t!==r})}},c.prototype.notify=function(){var r=this;this.subscribers.forEach(function(t){return t(r.cachedValue)})};var a=function(){this.stores=new Map,this.subscribers=[]};a.prototype.onStoresChanged=function(r){var t=this;return this.subscribers=this.subscribers.concat([r]),function(){t.subscribers=t.subscribers.filter(function(t){return t!==r})}},a.prototype.createStore=function(r){if(this.stores.has(r))throw new Error("Store already exist");var t=new c(r);return this.stores.set(r,t),this.notifyStoresChanged(),t},a.prototype.getStore=function(r){if(!this.stores.has(r))throw new Error("Store doesn't exist");return this.stores.get(r)},a.prototype.notifyStoresChanged=function(){this.subscribers.forEach(function(r){return r()})},a.prototype.getStoresArray=function(){var r=[];return this.stores.forEach(function(t){r.push(t)}),r};var f=function(){return new a},h=new a,l=function(){return h},b=function(r){return h=r},p=Object.prototype.hasOwnProperty;function y(r,t){return r===t?0!==r||0!==t||1/r==1/t:r!=r&&t!=t}function v(r,t){if(y(r,t))return!0;if("object"!=typeof r||null===r||"object"!=typeof t||null===t)return!1;var e=Object.keys(r),n=Object.keys(t);if(e.length!==n.length)return!1;for(var u=0;u<e.length;u++)if(!p.call(t,e[u])||!y(r[e[u]],t[e[u]]))return!1;return!0}var d=n(null),g=function(r){var t=r.children;return u(d.Provider,{value:l()},u(o,null,u(m,null),t))};Object.defineProperty(g,"displayName",{value:"ReusableProvider"});var S=new Map,w=function(){var r=t(d);if(null===r)throw new Error("Are you trying to use Reusable without a ReusableProvider?");return r},m=function(){var t=w(),n=r(function(){return t.getStoresArray()}),s=n[0],c=n[1];return e(function(){return t.onStoresChanged(function(){c(t.getStoresArray())})},[]),u(o,null,s.map(function(r,t){var n=function(r){if(!S.has(r)){var t=i(function(){return r.useValue(),e(function(){return r.notify()},[r.cachedValue]),null});Object.defineProperty(t,"name",{value:r.name}),S.set(r,t)}return S.get(r)}(r);return u(n,{key:t,store:r})}))};Object.defineProperty(m,"displayName",{value:"Stores"});var V=function(r){return r};function j(t){var n=l().createStore(t);return function(u,o){return s(n.name),function(t,n,u){var o=w().getStore(t);s("reusable");var i=r(function(){return n(o.getCachedValue())}),c=i[0],a=i[1];return e(function(){return o.subscribe(function(r){var t=n(r);u(t,c)||a(function(){return t})})},[o,c,n,u]),c}(t,u||V,o||v)}}export{c as Store,a as Container,f as createContainer,l as getContainer,b as replaceContainer,g as ReusableProvider,j as createStore};
//# sourceMappingURL=index.mjs.map
